version: "3.8"

services:
  # ------------------------------------------------
  # Service chính: Zalo Tool CRM (Đã đổi tên)
  # ------------------------------------------------
  zalo-tool:
    container_name: zalo-tool-crm
    build:
      context: .
      dockerfile: Dockerfile
      # Truyền biến build-time (để in vào HTML)
      args:
        NEXT_PUBLIC_SUPABASE_URL: ${NEXT_PUBLIC_SUPABASE_URL}
        NEXT_PUBLIC_SUPABASE_ANON_KEY: ${NEXT_PUBLIC_SUPABASE_ANON_KEY}

    restart: always
    ports:
      - "3000:3000"

    # Nạp biến runtime
    env_file:
      - .env

    environment:
      - TZ=Asia/Ho_Chi_Minh
      - NODE_ENV=production

    # Lưu log ra ngoài máy Windows
    volumes:
      - ./logs:/app/logs

  # ------------------------------------------------
  # Service phụ: Xem Log Realtime (Truy cập localhost:8888)
  # ------------------------------------------------
  log-viewer:
    image: amir20/dozzle:latest
    container_name: log-viewer
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    ports:
      - "8888:8080"
